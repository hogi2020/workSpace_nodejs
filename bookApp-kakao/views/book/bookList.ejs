<div class="row mt-5 justify-content-end">
    <div class="col-6 col-md-4">
        <form name="frm">
            <div class="input-group">
                <input type="text" name="query" class="form-control" value="자바" />
                <button class="btn btn-danger">검색</button>
            </div>
        </form>
    </div>
</div>

    <hr />
    <!-- 카카오 도서검색 결과를 출력할 공간 마련해둠 -->
    <div class="row" id="list_book"></div>
    <!-- 카카오 도서검색 결과를 출력할 공간 마련해둠 -->


<!-- 도서목록 템플릿 -->
<script type="text/x-handlebars-template" id="temp-book">
    <!-- each 옆에 dept 대신에 카카오 도서 검색 결과 라벨은 documents 
    배열의 이름이 다르면 출력이 안됨.-->
    {{#each documents}}
        <div class="col-6 col-md-4 col-lg-2">
            <div class="card my-2">
                <div class="card-body">
                    <img src="{{thumbnail}}" alt="도서이미지" style="cursor:pointer;width:80%">
                    <div class="ellipsis mt-2">{{title}}</div>
                </div>
                <div class="card-footer" style="font-size:0.8rem">
                    <div class="text-center">
                        {{price}}
                        <span style="cursor:pointer;color:green">CART</span>
                    </div>
                </div>
            </div>
        </div>
    {{/each}}
</script>


<div class="text-center mt-2">
    <button class="btn btn-primary btn-sm px-5" id="prev">이전</button>
    <span id="page" class="px-3">1/10</span>
    <button class="btn btn-primary btn-sm px-5" id="next">다음</button>
</div>

<script>
    //사용자가 입력한 키워드 가져오기
    let query = $(frm.query).val()
    let page = 1

    //도서 데이터 가져오기
    const getList = () => {
        // 사용자가 입력한 검색 키워드(query)와 page
        console.log(`page=${page}`, `query=${query}`)
        $.ajax({
            method: "GET",
            url: "https://dapi.kakao.com/v3/search/book?target=title",
            headers: { Authorization: "KakaoAK bf56a7a88829f13ba8fef4e0ed4c2aeb" },
            data: { query: query, page: page, size: 30 },
            dataType: "json",

            success: function (data) {
                console.log(data)
                let temp = Handlebars.compile($("#temp-book").html())
                $("#list_book").html(temp(data))

                // // 마지막 페이지 체크
                // let is_end = data.meta.is_end // false 책이 더 있어, true : 마지막 페이지가 맞다.
                // // 검색 가능한 데이터 수
                // let total = data.meta.total_count // 자바의 경우 5006
                // // 마지막 페이지 번호는 얼마야?
                // let last = Math.ceil(total/10)
                // console.log(`is_end: ${is_end}, total: ${total}, last: ${last}`)
            },
            error:function(error) {
                console.log(error)
            }
        });
    }
    getList()
    //검색창에서 입력한 책 제목 읽어오기
    
    $(frm).on('submit', (e) => {
        console.log("전송 호출")
        e.preventDefault()  // submit이슈 - 새로고침이 발생함 - 방치코드
        query = $(frm.query).val()  // 사용자가 입력한 책 제목
        page = 1    // 페이징 처리
        getList()   // 도서 정보를 카카오 검색 API활용
    })

</script>